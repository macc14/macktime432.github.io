<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="preconnect" href="https://ws.audioscrobbler.com">
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <title>mack's gallery</title>
  <link rel="icon" id="favicon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ“·</text></svg>">
  <script src="https://cdn.jsdelivr.net/npm/exif-js" async></script>
  <style>
    :root {
      --bg-color: #fafafa;
      --text-color: #333;
      --header-bg: #fff;
    }

    body.dark {
      --bg-color: #121212;
      --text-color: #fafafa;
      --header-bg: #1e1e1e;
    }

    body {
      margin: 0;
      font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
      font-weight: bold;
      background-color: var(--bg-color);
      color: var(--text-color);
      transition: background-color 0.3s, color 0.3s;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      overflow-x: hidden;
    }

    html {
      overflow-x: hidden;
    }

    header {
      padding: 1rem;
      font-size: 2rem;
      font-weight: bold;
      letter-spacing: 2px;
      background-color: var(--header-bg);
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
    }

    @media (max-width: 768px) {
      header {
        font-size: 1.5rem;
        padding: 0.75rem;
      }
    }

    .header-content {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .now-playing {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: relative;
    }

    .now-playing-img {
      width: 40px;
      height: 40px;
      border-radius: 4px;
      object-fit: cover;
      display: none;
      cursor: pointer;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      z-index: 100;
    }

    .now-playing-img:hover {
      transform: scale(3) translateY(20px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
      z-index: 1000;
    }

    .now-playing-tooltip {
      position: absolute;
      bottom: -40px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 0.8rem;
      white-space: nowrap;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      z-index: 1001;
    }

    .now-playing:hover .now-playing-tooltip {
      visibility: visible;
      opacity: 1;
    }

    .menu-toggle {
      font-size: 2rem;
      cursor: pointer;
      user-select: none;
      padding: 0.5rem;
    }

    .menu {
      display: flex;
      flex-direction: column;
      background-color: var(--header-bg);
      position: fixed;
      top: 0;
      left: -300px;
      width: 300px;
      height: 100vh;
      border-right: 2px solid #ddd;
      transition: left 0.3s ease;
      z-index: 2000;
      padding-top: 4rem;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }

    .menu a {
      padding: 1.5rem 2rem;
      text-decoration: none;
      color: var(--text-color);
      border-bottom: 1px solid #ddd;
      font-size: 1.2rem;
      transition: background-color 0.2s;
    }

    .menu a:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }

    body.dark .menu a:hover {
      background-color: rgba(255, 255, 255, 0.05);
    }

    .menu a:last-child {
      border-bottom: none;
    }

    .menu.show {
      left: 0;
    }

    .menu-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.5);
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s, visibility 0.3s;
      z-index: 1999;
    }

    .menu-overlay.show {
      opacity: 1;
      visibility: visible;
    }

    .toggle-btn {
      font-size: 1rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border: none;
      background-color: #333;
      color: white;
      border-radius: 5px;
    }

    @media (max-width: 768px) {
      .toggle-btn {
        font-size: 0.85rem;
        padding: 0.4rem 0.75rem;
      }
    }

    .gallery-container {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 1rem;
      box-sizing: border-box;
      width: 100%;
    }

    @media (max-width: 768px) {
      .gallery-container {
        padding: 4px;
        align-items: flex-start;
      }
    }

    .gallery {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      max-width: 1200px;
      width: 100%;
      box-sizing: border-box;
    }

    @media (max-width: 768px) {
      .gallery {
        grid-template-columns: repeat(2, 1fr);
        gap: 4px;
      }
    }

    @media (max-width: 480px) {
      .gallery {
        grid-template-columns: repeat(2, 1fr);
        gap: 2px;
      }
    }

    .gallery-item {
      position: relative;
      overflow: hidden;
    }

    .gallery img {
      width: 100%;
      height: auto;
      display: block;
      cursor: pointer;
      border-radius: 4px;
      transition: transform 0.3s;
      will-change: transform;
      content-visibility: auto;
    }

    @media (max-width: 768px) {
      .gallery img {
        border-radius: 2px;
      }
    }

    .gallery img:hover {
      transform: scale(1.02);
    }

    .photo-tooltip {
      position: absolute;
      background-color: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 0.9rem;
      white-space: nowrap;
      pointer-events: none;
      z-index: 100;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .photo-tooltip.show {
      opacity: 1;
    }

    /* Mobile: show date overlay on tap/touch */
    .photo-date-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(to top, rgba(0, 0, 0, 0.85), transparent);
      color: white;
      padding: 8px;
      font-size: 0.75rem;
      text-align: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      border-radius: 0 0 4px 4px;
      white-space: pre-line;
      line-height: 1.4;
    }

    .gallery-item.show-date .photo-date-overlay {
      opacity: 1;
    }

    @media (max-width: 768px) {
      .photo-date-overlay {
        font-size: 0.65rem;
        padding: 4px;
        border-radius: 0 0 2px 2px;
      }
    }

    .lightbox {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: 1000;
      padding: 1rem;
    }

    .lightbox.active {
      visibility: visible;
      opacity: 1;
    }

    .lightbox-content {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 100%;
    }

    .lightbox img {
      max-width: 90%;
      max-height: 80%;
      border-radius: 8px;
    }

    .caption {
      margin-top: 1rem;
      color: white;
      text-align: center;
      font-size: 1.5rem;
      max-width: 90%;
      word-wrap: break-word;
      background-color: rgba(0, 0, 0, 0.6);
      padding: 0.5rem 1rem;
      border-radius: 8px;
    }

    @media (max-width: 768px) {
      .caption {
        font-size: 1rem;
        padding: 0.4rem 0.75rem;
        max-width: 95%;
      }
    }

    @media (max-width: 480px) {
      .caption {
        font-size: 0.85rem;
        padding: 0.3rem 0.5rem;
      }
    }


    .nav-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 50px;
      height: 50px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 1.5rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      z-index: 10;
      -webkit-tap-highlight-color: transparent;
    }

    @media (max-width: 768px) {
      .nav-btn {
        width: 40px;
        height: 40px;
        font-size: 1.2rem;
      }
    }

    .nav-btn:hover {
      background: rgba(255, 255, 255, 0.4);
    }

    .prev-btn {
      left: 20px;
    }

    .next-btn {
      right: 20px;
    }

    .close-btn {
      position: absolute;
      top: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.2);
      border: none;
      border-radius: 50%;
      color: white;
      font-size: 1.2rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
      z-index: 10;
    }

    .close-btn:hover {
      background: rgba(255, 255, 255, 0.4);
    }
  </style>
</head>

<body>

  <div class="menu-overlay" id="menuOverlay"></div>

  <header>
    <div class="menu-toggle" id="menuToggle">&#9776;</div>
    <div class="header-content">
      <span>mack's gallery . :)</span>
      <div class="now-playing">
        <img class="now-playing-img" id="nowPlayingImg" alt="Now Playing">
        <div class="now-playing-tooltip" id="nowPlayingTooltip"></div>
      </div>
    </div>
    <button class="toggle-btn" id="modeToggle">Light/Dark</button>
  </header>

  <div class="menu" id="menu">
    <a href="/">Home</a>
  </div>

  <div class="gallery-container">
    <div class="gallery" id="gallery">
      <!-- Photos will be loaded dynamically -->
    </div>
  </div>

  <div class="lightbox" id="lightbox">
    <div class="lightbox-content">
      <button class="nav-btn prev-btn" id="prevBtn">&#10094;</button>
      <img src="" alt="Enlarged Photo" id="lightboxImage">
      <button class="nav-btn next-btn" id="nextBtn">&#10095;</button>
      <button class="close-btn" id="closeBtn">&#10005;</button>
    </div>
    <div class="caption" id="caption"></div>
  </div>

  <script>
    // Fetch list of all images from photos.json
    async function getPhotoFiles() {
      try {
        const response = await fetch('photos.json');
        if (!response.ok) {
          console.error('Could not load photos.json');
          return [];
        }
        const photoFiles = await response.json();
        return photoFiles;
      } catch (error) {
        console.error('Error fetching photo list:', error);
        return [];
      }
    }

    // Load photos and extract EXIF data to sort by date taken
    async function loadPhotos() {
      const photoFiles = await getPhotoFiles();
      
      if (photoFiles.length === 0) {
        console.warn('No photos found in directory');
        return;
      }
      
      const gallery = document.getElementById('gallery');
      const photosWithDates = [];

      // Helper function to convert GPS coordinates from DMS to decimal degrees
      function convertDMSToDD(degrees, minutes, seconds, direction) {
        let dd = degrees + minutes / 60 + seconds / 3600;
        if (direction === 'S' || direction === 'W') {
          dd = dd * -1;
        }
        return dd;
      }

      // Load all photos with promises (optimized)
      const promises = photoFiles.map(filename => {
        return new Promise((resolve) => {
          const img = new Image();
          img.src = filename;
          
          const timeout = setTimeout(() => {
            resolve({
              filename: filename,
              date: new Date(0),
              exifDate: null,
              formattedDate: null,
              gpsCoords: null
            });
          }, 5000); // 5 second timeout for slow loading images
          
          img.onload = function() {
            clearTimeout(timeout);
            // Try to get EXIF date
            if (typeof EXIF !== 'undefined') {
              EXIF.getData(img, function() {
              const dateTimeOriginal = EXIF.getTag(this, 'DateTimeOriginal');
              const dateTimeDigitized = EXIF.getTag(this, 'DateTimeDigitized');
              const dateTime = EXIF.getTag(this, 'DateTime');
              
              // Get GPS data
              const gpsLat = EXIF.getTag(this, 'GPSLatitude');
              const gpsLatRef = EXIF.getTag(this, 'GPSLatitudeRef');
              const gpsLon = EXIF.getTag(this, 'GPSLongitude');
              const gpsLonRef = EXIF.getTag(this, 'GPSLongitudeRef');
              
              let date;
              let formattedDate = null;
              let gpsCoords = null;
              
              // Parse EXIF date format: "YYYY:MM:DD HH:MM:SS"
              const exifDate = dateTimeOriginal || dateTimeDigitized || dateTime;
              if (exifDate) {
                const parts = exifDate.split(' ');
                const dateParts = parts[0].split(':');
                const timeParts = parts[1].split(':');
                date = new Date(
                  parseInt(dateParts[0]), 
                  parseInt(dateParts[1]) - 1, 
                  parseInt(dateParts[2]),
                  parseInt(timeParts[0]),
                  parseInt(timeParts[1]),
                  parseInt(timeParts[2])
                );
                
                // Format date as "October 31, 2025 at 6:23:57 PM"
                const monthNames = ['January', 'February', 'March', 'April', 'May', 'June',
                  'July', 'August', 'September', 'October', 'November', 'December'];
                const month = monthNames[date.getMonth()];
                const day = date.getDate();
                const year = date.getFullYear();
                let hours = date.getHours();
                const minutes = String(date.getMinutes()).padStart(2, '0');
                const seconds = String(date.getSeconds()).padStart(2, '0');
                const ampm = hours >= 12 ? 'PM' : 'AM';
                hours = hours % 12;
                hours = hours ? hours : 12; // the hour '0' should be '12'
                formattedDate = `${month} ${day}, ${year} at ${hours}:${minutes}:${seconds} ${ampm}`;
              } else {
                // Fallback to current date if no EXIF
                date = new Date(0);
              }
              
              // Convert GPS coordinates to decimal format
              if (gpsLat && gpsLon && gpsLatRef && gpsLonRef) {
                const latDecimal = convertDMSToDD(gpsLat[0], gpsLat[1], gpsLat[2], gpsLatRef);
                const lonDecimal = convertDMSToDD(gpsLon[0], gpsLon[1], gpsLon[2], gpsLonRef);
                gpsCoords = {
                  lat: latDecimal,
                  lon: lonDecimal,
                  formatted: `${latDecimal.toFixed(6)}, ${lonDecimal.toFixed(6)}`
                };
              }
              
              resolve({
                filename: filename,
                date: date,
                exifDate: exifDate,
                formattedDate: formattedDate,
                gpsCoords: gpsCoords
              });
            });
            } else {
              // EXIF library not loaded yet, resolve without metadata
              resolve({
                filename: filename,
                date: new Date(0),
                exifDate: null,
                formattedDate: null,
                gpsCoords: null
              });
            }
          };
          
          img.onerror = function() {
            clearTimeout(timeout);
            resolve({
              filename: filename,
              date: new Date(0),
              exifDate: null,
              formattedDate: null,
              gpsCoords: null
            });
          };
        });
      });

      // Wait for all photos to load
      const results = await Promise.all(promises);
      
      // Sort by date (newest first)
      results.sort((a, b) => b.date - a.date);

      // Add sorted images to gallery
      results.forEach((photo, index) => {
        const galleryItem = document.createElement('div');
        galleryItem.className = 'gallery-item';
        
        const imgElement = document.createElement('img');
        imgElement.src = photo.filename;
        imgElement.loading = 'lazy'; // Native lazy loading
        imgElement.decoding = 'async'; // Async image decoding
        
        // Build alt text with date and location
        let altText = photo.formattedDate ? photo.formattedDate : `Photo ${index + 1}`;
        if (photo.gpsCoords) {
          altText += ` | Location: ${photo.gpsCoords.formatted}`;
        }
        imgElement.alt = altText;
        
        // Store data attributes
        imgElement.dataset.exifDate = photo.formattedDate || 'Date not available';
        if (photo.gpsCoords) {
          imgElement.dataset.gpsCoords = photo.gpsCoords.formatted;
          imgElement.dataset.gpsLat = photo.gpsCoords.lat;
          imgElement.dataset.gpsLon = photo.gpsCoords.lon;
        }
        
        const dateOverlay = document.createElement('div');
        dateOverlay.className = 'photo-date-overlay';
        let overlayText = photo.formattedDate || 'Date not available';
        if (photo.gpsCoords) {
          overlayText += `\nðŸ“ ${photo.gpsCoords.formatted}`;
        }
        dateOverlay.textContent = overlayText;
        
        galleryItem.appendChild(imgElement);
        galleryItem.appendChild(dateOverlay);
        gallery.appendChild(galleryItem);
      });

      // Update images array for lightbox
      images.length = 0;
      images.push(...gallery.querySelectorAll('img'));
    }

    // Load photos on page load
    document.addEventListener('DOMContentLoaded', () => {
      loadPhotos();
      fetchNowPlaying();
    });

    // Now Playing Fetch
    const LAST_FM_API_KEY = 'd1beb278f4fc1f2ac27636a790ecc0ef';
    const LAST_FM_USERNAME = 'macc14';
    let currentSpotifyUrl = null;

    async function fetchNowPlaying() {
      try {
        const response = await fetch(`https://ws.audioscrobbler.com/2.0/?method=user.getrecenttracks&user=${LAST_FM_USERNAME}&api_key=${LAST_FM_API_KEY}&format=json&limit=1`);
        if (!response.ok) throw new Error('Failed to fetch data');
        const data = await response.json();
        const track = data.recenttracks.track[0];
        if (!track) return;

        const trackInfo = {
          name: track.name,
          artist: track.artist['#text'],
          album: track.album['#text'],
          image: track.image[track.image.length - 1]['#text']
        };

        if (trackInfo.image) {
          document.getElementById('favicon').href = trackInfo.image;
          const nowPlayingImg = document.getElementById('nowPlayingImg');
          nowPlayingImg.src = trackInfo.image;
          nowPlayingImg.style.display = 'block';
          document.getElementById('nowPlayingTooltip').textContent = `${trackInfo.name} - ${trackInfo.artist}`;
        }

        // Fetch Spotify URL using Last.fm track.getInfo
        try {
          const trackInfoResponse = await fetch(`https://ws.audioscrobbler.com/2.0/?method=track.getInfo&api_key=${LAST_FM_API_KEY}&artist=${encodeURIComponent(trackInfo.artist)}&track=${encodeURIComponent(trackInfo.name)}&format=json`);
          if (trackInfoResponse.ok) {
            const trackData = await trackInfoResponse.json();
            if (trackData.track && trackData.track.url) {
              // Try to get Spotify link from track data or construct search URL
              const spotifySearchUrl = `https://open.spotify.com/search/${encodeURIComponent(trackInfo.artist + ' ' + trackInfo.name)}`;
              currentSpotifyUrl = spotifySearchUrl;
            }
          }
        } catch (error) {
          console.error('Error fetching Spotify link:', error);
          // Fallback to Spotify search
          currentSpotifyUrl = `https://open.spotify.com/search/${encodeURIComponent(trackInfo.artist + ' ' + trackInfo.name)}`;
        }
      } catch (error) {
        console.error('Error fetching Last.fm data:', error);
      }
    }

    document.addEventListener('DOMContentLoaded', fetchNowPlaying);
    setInterval(fetchNowPlaying, 60000); // Reduced frequency to 60 seconds to reduce API calls

    // Add click handler for album art to open Spotify
    document.getElementById('nowPlayingImg').addEventListener('click', function(e) {
      e.stopPropagation();
      if (currentSpotifyUrl) {
        window.open(currentSpotifyUrl, '_blank');
      }
    });

    // Lightbox functionality
    const gallery = document.getElementById('gallery');
    const lightbox = document.getElementById('lightbox');
    const lightboxImage = document.getElementById('lightboxImage');
    const caption = document.getElementById('caption');
    const images = []; // Will be populated after photos load
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const closeBtn = document.getElementById('closeBtn');
    const nowPlayingImg = document.getElementById('nowPlayingImg');

    let currentIndex = -1;

    function showImage() {
      if (images.length === 0) return;
      const img = images[currentIndex];
      lightboxImage.src = img.src;
      caption.textContent = img.alt;
      lightbox.classList.add('active');
    }

    function hideLightbox() {
      lightbox.classList.remove('active');
      caption.textContent = '';
      currentIndex = -1;
    }

    function showNext() {
      if (images.length === 0) return;
      currentIndex = (currentIndex + 1) % images.length;
      showImage();
    }

    function showPrev() {
      if (images.length === 0) return;
      currentIndex = (currentIndex - 1 + images.length) % images.length;
      showImage();
    }

    gallery.addEventListener('click', function (e) {
      const clickedImg = e.target.closest('img');
      const galleryItem = e.target.closest('.gallery-item');
      
      if (clickedImg && clickedImg !== nowPlayingImg && galleryItem) {
        currentIndex = images.indexOf(clickedImg);
        if (currentIndex !== -1) {
          showImage();
        }
      }
    });

    nextBtn.addEventListener('click', function (e) {
      e.stopPropagation();
      showNext();
    });

    prevBtn.addEventListener('click', function (e) {
      e.stopPropagation();
      showPrev();
    });

    closeBtn.addEventListener('click', function (e) {
      e.stopPropagation();
      hideLightbox();
    });

    lightbox.addEventListener('click', function (e) {
      if (e.target === lightbox) {
        hideLightbox();
      }
    });

    document.addEventListener('keydown', function (e) {
      if (lightbox.classList.contains('active')) {
        if (e.key === 'Escape') hideLightbox();
        else if (e.key === 'ArrowRight') showNext();
        else if (e.key === 'ArrowLeft') showPrev();
      }
    });

    let touchStartX = 0;
    let touchEndX = 0;

    lightbox.addEventListener('touchstart', function (e) {
      touchStartX = e.changedTouches[0].screenX;
    });

    lightbox.addEventListener('touchend', function (e) {
      touchEndX = e.changedTouches[0].screenX;
      if (touchEndX < touchStartX - 50) showNext();
      if (touchEndX > touchStartX + 50) showPrev();
    });

    const modeToggle = document.getElementById('modeToggle');
    const currentMode = localStorage.getItem('theme');

    if (currentMode === 'dark') document.body.classList.add('dark');

    modeToggle.addEventListener('click', function () {
      document.body.classList.toggle('dark');
      localStorage.setItem('theme', document.body.classList.contains('dark') ? 'dark' : 'light');
    });

    const menuToggle = document.getElementById('menuToggle');
    const menu = document.getElementById('menu');
    const menuOverlay = document.getElementById('menuOverlay');

    menuToggle.addEventListener('click', function () {
      menu.classList.toggle('show');
      menuOverlay.classList.toggle('show');
    });

    // Close menu when clicking overlay
    menuOverlay.addEventListener('click', function () {
      menu.classList.remove('show');
      menuOverlay.classList.remove('show');
    });

    // Close menu when clicking a link
    menu.addEventListener('click', function (e) {
      if (e.target.tagName === 'A') {
        menu.classList.remove('show');
        menuOverlay.classList.remove('show');
      }
    });

    // Photo hover tooltip (desktop)
    const tooltip = document.createElement('div');
    tooltip.className = 'photo-tooltip';
    document.body.appendChild(tooltip);

    gallery.addEventListener('mouseover', function(e) {
      if (e.target.tagName === 'IMG' && e.target.closest('.gallery-item') && e.target !== nowPlayingImg) {
        const exifDate = e.target.dataset.exifDate;
        tooltip.textContent = exifDate;
        tooltip.classList.add('show');
      }
    });

    gallery.addEventListener('mousemove', function(e) {
      if (e.target.tagName === 'IMG' && e.target.closest('.gallery-item') && e.target !== nowPlayingImg) {
        tooltip.style.left = e.pageX + 15 + 'px';
        tooltip.style.top = e.pageY + 15 + 'px';
      }
    });

    gallery.addEventListener('mouseout', function(e) {
      if (e.target.tagName === 'IMG') {
        tooltip.classList.remove('show');
      }
    });

    // Mobile: Show date overlay on long press (not tap to avoid scroll issues)
    let activeDateOverlay = null;
    let touchTimer = null;
    let hasMoved = false;
    
    gallery.addEventListener('touchstart', function(e) {
      const galleryItem = e.target.closest('.gallery-item');
      if (galleryItem && e.target.tagName === 'IMG') {
        hasMoved = false;
        
        // Long press to show date (500ms)
        touchTimer = setTimeout(() => {
          if (!hasMoved) {
            // Remove active state from previous item
            if (activeDateOverlay && activeDateOverlay !== galleryItem) {
              activeDateOverlay.classList.remove('show-date');
            }
            
            galleryItem.classList.add('show-date');
            activeDateOverlay = galleryItem;
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
              if (activeDateOverlay === galleryItem) {
                galleryItem.classList.remove('show-date');
                activeDateOverlay = null;
              }
            }, 3000);
          }
        }, 500);
      }
    });
    
    gallery.addEventListener('touchmove', function(e) {
      hasMoved = true;
      if (touchTimer) {
        clearTimeout(touchTimer);
        touchTimer = null;
      }
    });
    
    gallery.addEventListener('touchend', function(e) {
      if (touchTimer) {
        clearTimeout(touchTimer);
        touchTimer = null;
      }
    });

    // Remove overlay when scrolling
    let scrollTimeout;
    gallery.parentElement.addEventListener('scroll', function() {
      if (activeDateOverlay) {
        activeDateOverlay.classList.remove('show-date');
        activeDateOverlay = null;
      }
      if (touchTimer) {
        clearTimeout(touchTimer);
        touchTimer = null;
      }
    });
  </script>

</body>

</html>
